//楼层模拟数据
var floorData = [{
  'floorName': '服装鞋包', 'tab': [{
    'tabName': '大牌', 'tabData': [{
      'src': 'floor/1.png', 'name': '匡威男棒球开衫外套2015', 'price': '479'
    }, {
      'src': 'floor/1.png', 'name': 'adidas 阿迪达斯 训练 男子', 'price': '335'
    }, {
      'src': 'floor/1.jpg', 'name': '必迈BMAI——体织跑步短袖T恤', 'price': '159'
    }, {
      'src': 'floor/1.jpg', 'name': 'NBA袜子半毛圈运动高邦棉袜', 'price': '65'
    }, {
      'src': 'floor/1.png', 'name': '特步官方运动帽男女帽子2016', 'price': '69'
    }, {
      'src': 'floor/1.png', 'name': 'KELME足球训练防寒防风手套', 'price': '4999'
    }, {
      'src': 'floor/2.jpg', 'name': '战地吉普三合一冲锋衣', 'price': '289'
    }, {
      'src': 'floor/2.jpg', 'name': '探路者户外男士徒步鞋', 'price': '369'
    }, {
      'src': 'floor/1.png', 'name': '羽绒服2015秋冬新款轻薄男士', 'price': '399'
    }, {
      'src': 'floor/1.png', 'name': '溯溪鞋涉水鞋户外鞋', 'price': '689'
    }, {
      'src': 'floor/3.jpg', 'name': '旅行背包多功能双肩包', 'price': '269'
    }, {
      'src': 'floor/3.jpg', 'name': '户外旅行双肩背包OS0099', 'price': '99'
    }]
  }, {
    'tabName': '男装', 'tabData': [{
      'src': 'floor/6.jpg', 'name': '匡威男棒球开衫外套2015', 'price': '479'
    }, {
      'src': 'floor/3.jpg', 'name': '户外旅行双肩背包OS0099', 'price': '99'
    }]
  }, {
    'tabName': '女装', 'tabData': [{
      'src': 'floor/4.jpg', 'name': '必迈BMAI——体织跑步短袖T恤', 'price': '231'
    }, {
      'src': 'floor/1.png', 'name': '羽绒服2015秋冬新款轻薄男士', 'price': '399'
    }, {
      'src': 'floor/1.png', 'name': '溯溪鞋涉水鞋户外鞋', 'price': '689'
    }]
  }]
}, {
  'floorName': '个护美妆', 'tab': [{
    'tabName': '热门', 'tabData': [{
      'src': 'floor/5.jpg', 'name': '匡威男棒球开衫外套2015', 'price': '479'
    }, {
      'src': 'floor/5.jpg', 'name': 'adidas 阿迪达斯 训练 男子', 'price': '335'
    }, {
      'src': 'floor/5.jpg', 'name': '必迈BMAI——体织跑步短袖T恤', 'price': '159'
    }, {
      'src': 'floor/5.jpg', 'name': 'NBA袜子半毛圈运动高邦棉袜', 'price': '65'
    }, {
      'src': 'floor/5.jpg', 'name': '特步官方运动帽男女帽子2016', 'price': '69'
    }, {
      'src': 'floor/5.jpg', 'name': 'KELME足球训练防寒防风手套', 'price': '4999'
    }, {
      'src': 'floor/1.png', 'name': '战地吉普三合一冲锋衣', 'price': '289'
    }, {
      'src': 'floor/1.png', 'name': '探路者户外男士徒步鞋', 'price': '369'
    }, {
      'src': 'floor/1.png', 'name': '羽绒服2015秋冬新款轻薄男士', 'price': '399'
    }, {
      'src': 'floor/1.png', 'name': '溯溪鞋涉水鞋户外鞋', 'price': '689'
    }, {
      'src': 'floor/1.png', 'name': '旅行背包多功能双肩包', 'price': '269'
    }, {
      'src': 'floor/1.png', 'name': '户外旅行双肩背包OS0099', 'price': '99'
    }]
  }, {
    'tabName': '国际大牌', 'tabData': [{
      'src': 'floor/6.jpg', 'name': '匡威男棒球开衫外套2015', 'price': '479'
    }, {
      'src': 'floor/1.png', 'name': '羽绒服2015秋冬新款轻薄男士', 'price': '399'
    }, {
      'src': 'floor/1.png', 'name': '溯溪鞋涉水鞋户外鞋', 'price': '689'
    }]
  }, {
    'tabName': '国际名牌', 'tabData': [{
      'src': 'floor/4.jpg', 'name': '必迈BMAI——体织跑步短袖T恤', 'price': '231'
    }, {
      'src': 'floor/1.png', 'name': '羽绒服2015秋冬新款轻薄男士', 'price': '399'
    }]
  }]
}, {
  'floorName': '手机通讯', 'tab': [{
    'tabName': '热门', 'tabData': [{
      'src': 'floor/7.jpg', 'name': '匡威男棒球开衫外套2015', 'price': '479'
    }, {
      'src': 'floor/7.jpg', 'name': 'adidas 阿迪达斯 训练 男子', 'price': '335'
    }, {
      'src': 'floor/7.jpg', 'name': '必迈BMAI——体织跑步短袖T恤', 'price': '159'
    }, {
      'src': 'floor/7.jpg', 'name': 'NBA袜子半毛圈运动高邦棉袜', 'price': '65'
    }, {
      'src': 'floor/7.jpg', 'name': '特步官方运动帽男女帽子2016', 'price': '69'
    }, {
      'src': 'floor/7.jpg', 'name': 'KELME足球训练防寒防风手套', 'price': '4999'
    }, {
      'src': 'floor/7.jpg', 'name': '战地吉普三合一冲锋衣', 'price': '289'
    }, {
      'src': 'floor/7.jpg', 'name': '探路者户外男士徒步鞋', 'price': '369'
    }, {
      'src': 'floor/7.jpg', 'name': '羽绒服2015秋冬新款轻薄男士', 'price': '399'
    }, {
      'src': 'floor/7.jpg', 'name': '溯溪鞋涉水鞋户外鞋', 'price': '689'
    }, {
      'src': 'floor/7.jpg', 'name': '旅行背包多功能双肩包', 'price': '269'
    }, {
      'src': 'floor/7.jpg', 'name': '户外旅行双肩背包OS0099', 'price': '99'
    }]
  }, {
    'tabName': '品质优选', 'tabData': [{
      'src': 'floor/7.jpg', 'name': '匡威男棒球开衫外套2015', 'price': '479'
    }, {
      'src': 'floor/1.png', 'name': '羽绒服2015秋冬新款轻薄男士', 'price': '399'
    }, {
      'src': 'floor/1.png', 'name': '羽绒服2015秋冬新款轻薄男士', 'price': '399'
    }]
  }, {
    'tabName': '新机尝鲜', 'tabData': [{
      'src': 'floor/7.jpg', 'name': '必迈BMAI——体织跑步短袖T恤', 'price': '231'
    }, {
      'src': 'floor/1.png', 'name': '羽绒服2015秋冬新款轻薄男士', 'price': '399'
    }]
  }]
}, {
  'floorName': '家用电器', 'tab': [{
    'tabName': '热门', 'tabData': [{
      'src': 'floor/8.jpg', 'name': '匡威男棒球开衫外套2015', 'price': '479'
    }, {
      'src': 'floor/8.jpg', 'name': 'adidas 阿迪达斯 训练 男子', 'price': '335'
    }, {
      'src': 'floor/8.jpg', 'name': '必迈BMAI——体织跑步短袖T恤', 'price': '159'
    }, {
      'src': 'floor/8.jpg', 'name': 'NBA袜子半毛圈运动高邦棉袜', 'price': '65'
    }, {
      'src': 'floor/8.jpg', 'name': '特步官方运动帽男女帽子2016', 'price': '69'
    }, {
      'src': 'floor/8.jpg', 'name': 'KELME足球训练防寒防风手套', 'price': '4999'
    }, {
      'src': 'floor/8.jpg', 'name': '战地吉普三合一冲锋衣', 'price': '289'
    }, {
      'src': 'floor/8.jpg', 'name': '探路者户外男士徒步鞋', 'price': '369'
    }, {
      'src': 'floor/8.jpg', 'name': '羽绒服2015秋冬新款轻薄男士', 'price': '399'
    }, {
      'src': 'floor/8.jpg', 'name': '溯溪鞋涉水鞋户外鞋', 'price': '689'
    }, {
      'src': 'floor/8.jpg', 'name': '旅行背包多功能双肩包', 'price': '269'
    }, {
      'src': 'floor/8.jpg', 'name': '户外旅行双肩背包OS0099', 'price': '99'
    }]
  }, {
    'tabName': '大家电', 'tabData': [{
      'src': 'floor/8.jpg', 'name': '匡威男棒球开衫外套2015', 'price': '479'
    }, {
      'src': 'floor/8.jpg', 'name': '羽绒服2015秋冬新款轻薄男士', 'price': '399'
    }, {
      'src': 'floor/8.jpg', 'name': '羽绒服2015秋冬新款轻薄男士', 'price': '399'
    }]
  }, {
    'tabName': '生活电器', 'tabData': [{
      'src': 'floor/8.jpg', 'name': '必迈BMAI——体织跑步短袖T恤', 'price': '231'
    }, {
      'src': 'floor/8.jpg', 'name': '羽绒服2015秋冬新款轻薄男士', 'price': '399'
    }]
  }]
}, {
  'floorName': '电脑数码', 'tab': [{
    'tabName': '热门', 'tabData': [{
      'src': 'floor/9.jpg', 'name': '匡威男棒球开衫外套2015', 'price': '479'
    }, {
      'src': 'floor/9.jpg', 'name': 'adidas 阿迪达斯 训练 男子', 'price': '335'
    }, {
      'src': 'floor/9.jpg', 'name': '必迈BMAI——体织跑步短袖T恤', 'price': '159'
    }, {
      'src': 'floor/9.jpg', 'name': 'NBA袜子半毛圈运动高邦棉袜', 'price': '65'
    }, {
      'src': 'floor/9.jpg', 'name': '特步官方运动帽男女帽子2016', 'price': '69'
    }, {
      'src': 'floor/9.jpg', 'name': 'KELME足球训练防寒防风手套', 'price': '4999'
    }, {
      'src': 'floor/9.jpg', 'name': '战地吉普三合一冲锋衣', 'price': '289'
    }, {
      'src': 'floor/9.jpg', 'name': '探路者户外男士徒步鞋', 'price': '369'
    }, {
      'src': 'floor/9.jpg', 'name': '羽绒服2015秋冬新款轻薄男士', 'price': '399'
    }, {
      'src': 'floor/9.jpg', 'name': '溯溪鞋涉水鞋户外鞋', 'price': '689'
    }, {
      'src': 'floor/9.jpg', 'name': '旅行背包多功能双肩包', 'price': '269'
    }, {
      'src': 'floor/9.jpg', 'name': '户外旅行双肩背包OS0099', 'price': '99'
    }]
  }, {
    'tabName': '电脑/平板', 'tabData': [{
      'src': 'floor/9.jpg', 'name': '匡威男棒球开衫外套2015', 'price': '479'
    }, {
      'src': 'floor/8.jpg', 'name': '羽绒服2015秋冬新款轻薄男士', 'price': '399'
    }, {
      'src': 'floor/8.jpg', 'name': '羽绒服2015秋冬新款轻薄男士', 'price': '399'
    }]
  }, {
    'tabName': '潮流影音', 'tabData': [{
      'src': 'floor/9.jpg', 'name': '必迈BMAI——体织跑步短袖T恤', 'price': '231'
    }, {
      'src': 'floor/8.jpg', 'name': '羽绒服2015秋冬新款轻薄男士', 'price': '399'
    }]
  }]
}];

/*楼层*/
var floor = $('.floor');
var index = 0;
var floorNav = $('.floorNav');
var lis = floorNav.find('li');
var footer = $('.footer');

ctrlFloor();

function ctrlFloor() {
  addItem();

  changeTab();

  calHeight();

  navAction();
}

/*页面滚动监听*/
function windowScroll() {
  var winH = $(window).height();//可视窗口高度
  var iTop = $(window).scrollTop();//鼠标滚动的距离
  var items = floor.find('.floorItem');

  if (iTop > floor.offset().top - 200 && (iTop - (footer.offset().top - 170)) < 0) {
    floorNav.fadeIn();

    items.each(function () {
      if (winH + iTop - $(this).offset().top > winH / 1.5) {
        lis.children('.fNum').removeClass('fActive').eq($(this).index()).addClass('fActive');

        lis.children('.fNum').show().eq($(this).index()).hide();
        lis.children('.fName').hide().eq($(this).index()).show();

        index = $(this).index();
      }
    })

  } else {
    floorNav.fadeOut();
  }
}

function calHeight() {
  $(window).on('scroll', windowScroll);
}

/*左侧楼层导航事件*/
function navAction() {
  lis.click(function () {
    $(window).off('scroll');

    lis.children('.fNum').removeClass('fActive').eq($(this).index()).addClass('fActive');
    lis.children('.fNum').show().eq($(this).index()).hide();
    lis.children('.fName').hide().eq($(this).index()).show();
    index = $(this).index();

    var top = $('.floor .floorItem').eq($(this).index()).offset().top;

    $('html,body').animate({scrollTop: top}, 300, null, function () {
      $(window).on('scroll', windowScroll);
    });
  });

  lis.mouseenter(function () {
    if ($(this).index() !== index) {
      $(this).children('.fNum').hide();
      $(this).children('.fName').show();
    }
  });

  lis.mouseleave(function () {
    if ($(this).index() !== index) {
      $(this).children('.fNum').show();
      $(this).children('.fName').hide();
    }
  });
}

/*楼层tab页切换*/
function changeTab() {
  var floor = $('.floor');
  var divs = floor.find('.right>div');

  divs.mouseenter(function () {
    var item = $(this).parents('.floorItem');
    item.find('.span').removeClass('spanActive');
    item.find('.arrow').removeClass('arrowActive');
    $(this).find('.span').addClass('spanActive');
    $(this).find('.arrow').addClass('arrowActive');

    item.children('.grid')
        .removeClass('gridActive')
        .eq($(this).length - $(this).index() + 1)
        .addClass('gridActive');
  })
}

/*添加楼层数据*/
function addItem() {
  var item = floor.find('.floorItem');

  for (var i = 0; i < floorData.length; i++) {
    var fData = floorData[i];

    var newItem = item.clone(true).appendTo('.floor');
    newItem.show();
    newItem.find('.floorNum').text((i + 1) + 'F');
    newItem.find('.title').text(fData.floorName);

    var tabData = fData.tab;

    for (var j = tabData.length - 1; j >= 0; j--) {
      var tData = tabData[j];
      newItem.find('.right .span').eq(tabData.length - 1 - j).text(tData.tabName);
      var grid = newItem.find('.grid').eq(j);

      var goodsData = tData.tabData;

      for (var k = 0; k < goodsData.length; k++) {
        var gData = goodsData[k];
        var cell = grid.find('.cell').eq(k);
        cell.find('img').attr('src', 'img/' + gData.src);
        cell.find('.name').html(gData.name);
        cell.children('.price').html('￥' + gData.price);
      }
    }
  }

  floor.find('.floorItem').eq(0).remove();
}